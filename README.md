# Rust ARI RTP Echo Project

Проект на Rust состоит из двух бинарников: `ari` и `echo`. Он позволяет подключаться к Asterisk через ARI и тестировать RTP-потоки с внешней медиасессией.

---

## Содержание

- [Описание](#описание)
- [Требования](#требования)
- [Переменные окружения](#переменные-окружения)
- [Запуск проекта](#запуск-проекта)
- [Связь между ari и echo](#связь-между-ari-и-echo)

---

## Описание

### 1. ari.rs – ARI Client

- Подключается к Asterisk через ARI.
- Отвечает на новые каналы.
- Создаёт мост типа `Mixing` между каналом Asterisk и внешней RTP-сессией.
- Отслеживает завершение каналов и удаляет внешние медиа-сессии.

### 2. echo.rs – RTP Echo Server

- Принимает RTP-пакеты по UDP на порт `5004`.
- Возвращает пакеты обратно на порт `5005` (порт +1).
- Сохраняет статистику задержки и успешной/неудачной доставки пакетов.
- Поддерживает несколько SSRC одновременно.

---

## Требования

- Rust 1.70+  
- Asterisk с включённым ARI (обычно `http://<asterisk_host>:8088/ari`)  
- Созданное приложение в `ari.conf` (например, `my_app`)  
- Пользователь ARI с правами на: `stasis`, `channels`, `bridges`

---

## Переменные окружения

Создайте файл `.env` в корне проекта для `ari.rs`:

```env
ASTERISK_URL=http://127.0.0.1:8088/ari
ASTERISK_USER=ari_user
ASTERISK_PASSWORD=ari_password
ASTERISK_URL — URL ARI сервера Asterisk
```

ASTERISK_USER — имя пользователя ARI

ASTERISK_PASSWORD — пароль пользователя ARI

Для echo.rs переменные окружения не требуются — он слушает порт 5004 по умолчанию.

## Запуск проекта
1. Запуск ARI клиента
bash
Copy code
cargo run --bin ari
Подключается к Asterisk.

* Автоматически отвечает на каналы и создаёт мост с внешней RTP-сессией.

* Логирует события открытия и закрытия каналов.

2. Запуск RTP Echo сервера
bash
Copy code
cargo run --bin echo
Слушает UDP порт 5004.

* Эхо-пакеты отправляются обратно на порт 5005.

* По окончании сессии выводится статистика:

* p50/p95/p99 задержки пакетов

* Успешные и неудачные пакеты

* Связь между ari и echo
ari.rs создаёт внешний RTP-поток на IP 77.110.104.14:5004.

echo.rs принимает пакеты на этом порту и возвращает их обратно.

Вместе они позволяют тестировать медиапотоки через Asterisk ARI и внешние RTP-сессии.
